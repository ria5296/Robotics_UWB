<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR 코드 스캔</title>
    <style>
        /* 전체 화면 블러 처리된 카메라 */
        #video-blur {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            filter: blur(4px) brightness(70%);  /* 블러 및 밝기 조정 */
        }

        /* 강조된 테두리 */
        .border {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 270px;
            height: 270px;
            transform: translate(-50%, -50%);
            z-index: 4;
            background:
                linear-gradient(to right, #663bab 15px, transparent 4px) 0 0,
                linear-gradient(to right, #663bab 15px, transparent 4px) 0 100%,
                linear-gradient(to left, #663bab 15px, transparent 4px) 100% 0,
                linear-gradient(to left, #663bab 15px, transparent 4px) 100% 100%,
                linear-gradient(to bottom, #663bab 15px, transparent 4px) 0 0,
                linear-gradient(to bottom, #663bab 15px, transparent 4px) 100% 0,
                linear-gradient(to top, #663bab 15px, transparent 4px) 0 100%,
                linear-gradient(to top, #663bab 15px, transparent 4px) 100% 100%;
            background-repeat: no-repeat;
            background-size: 50px 50px;
            border-radius: 20px;  /* 둥근 테두리 */
        }

        /* QR 코드 스캔 영역 (선명한 카메라) */
        .scan-area {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 250px; /* 정사각형 크기 */
            height: 250px; /* 정사각형 크기 */
            transform: translate(-50%, -50%);
            background: transparent;
            z-index: 2;
            overflow: hidden;
            border-radius: 15px;  /* 둥근 테두리 */
        }

        /* 가운데 네모 영역 안에 선명한 카메라 (확대된 카메라 화면) */
        #video-clear {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 750px;  /* 확대된 비디오 크기 */
            height: 750px; /* 확대된 비디오 크기 */
            transform: translate(-50%, -50%);
            object-fit: cover;  /* 비디오 크롭 */
            z-index: 1;
        }

        /* QR 코드 스캔하기 텍스트 */
        .qr-text {
            position: absolute;
            top: 15%;  /* 사각형 영역 위쪽에 텍스트 배치 */
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 28px;  /* 텍스트 크기 줄이기 */
            font-weight: bold;
            z-index: 3;
            text-align: center;
            white-space: nowrap;  /* 텍스트가 두 줄로 나뉘지 않도록 설정 */
        }

        /* 닫기 버튼 (X 표시) */
        .close-button {
            position: absolute;
            top: 35px;
            right: 30px;
            width: 35px;
            height: 35px;
            background-color: transparent;
            color: white;
            font-size: 28px;  /* X 크기 */
            border: none;
            cursor: pointer;
            z-index: 5;
            text-align: center;
            line-height: 35px; /* X가 버튼 중앙에 오도록 설정 */
            border-radius: 50%; /* 원형 버튼 */
        }

        .close-button:hover {
            background-color: rgba(255, 255, 255, 0.3); /* 호버 시 배경 */
        }
    </style>
</head>
<body>

    <!-- 블러 처리된 전체 카메라 -->
    <video id="video-blur" autoplay></video>

    <!-- 강조된 테두리 -->
    <div class="border">
        <div class="scan-area">
            <!-- 선명한 카메라 화면 (네모 안) -->
            <video id="video-clear" autoplay></video>
        </div>
    </div>

    <!-- QR 코드 스캔하기 텍스트 -->
    <div class="qr-text">QR 코드 스캔하기</div>

    <!-- 닫기 버튼 -->
    <button class="close-button" onclick="goBack()">X</button>

    <script>
        // 웹캠 활성화 (블러된 화면 & 선명한 화면)
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                document.getElementById("video-blur").srcObject = stream;
                document.getElementById("video-clear").srcObject = stream;
            } catch (error) {
                console.error("카메라 접근 실패:", error);
            }
        }

        // 닫기 버튼 클릭 시 index.html로 이동
        function goBack() {
            window.location.href = "/";  // Flask 기반이면 루트(/)로 이동
        }

        // 페이지 로드 시 카메라 실행
        window.onload = startCamera;
    </script>

</body>
</html>
